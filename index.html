<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <meta name="google-adsense-account" content="ca-pub-3194084220429968" />
    <style>
      :root {
        --brand: #ff5722;
        --brand2: #ff8a50;
        --card: #fff;
        --muted: #67748e;
        --ok: #1faa59;
        --bad: #e53935;
        --bg1: #071426;
        --bg2: #0b2b46;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Cairo", sans-serif;
        color: #0d1b2a;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, var(--bg1), var(--bg2));
        padding: 18px;
      }
      .app {
        width: 100%;
        max-width: 1150px;
        overflow: hidden;
        border-radius: 16px;
        background: linear-gradient(180deg, #fff, #fafafa);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 16px 20px;
        color: #fff;
        background: linear-gradient(90deg, var(--brand), var(--brand2));
      }
      header h1 {
        margin: 0;
        font-size: 18px;
      }
      header .sub {
        opacity: 0.95;
        font-size: 13px;
      }

      main {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 16px;
        padding: 18px;
      }
      @media (max-width: 980px) {
        main {
          grid-template-columns: 1fr;
        }
        .aside {
          order: 2;
        }
      }

      .card {
        background: var(--card);
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
      }
      .welcome {
        display: grid;
        gap: 12px;
        place-items: center;
        padding: 28px;
      }
      .input {
        width: 100%;
        max-width: 320px;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid #eee;
        outline: none;
        font-size: 16px;
      }
      .btn {
        background: var(--brand);
        color: #fff;
        border: none;
        padding: 12px 16px;
        border-radius: 12px;
        font-weight: 800;
        cursor: pointer;
        transition: 0.15s transform, 0.15s box-shadow;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.1);
      }
      .meta {
        color: var(--muted);
        font-size: 13px;
      }

      .question {
        font-size: 20px;
        margin: 10px 0 6px;
      }
      .options {
        display: grid;
        gap: 10px;
      }
      .option {
        background: #f6f8fa;
        padding: 12px;
        border-radius: 12px;
        text-align: center;
        font-weight: 800;
        border: 2px solid transparent;
        cursor: pointer;
        transition: 0.16s;
      }
      .option:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
      }
      .option.correct {
        background: #e8f8ef;
        border-color: var(--ok);
      }
      .option.wrong {
        background: #ffecec;
        border-color: var(--bad);
      }

      /* Ø§Ù„Ø£Ø³Ø§Ø³ */
      #question {
        font-size: 1.5rem;
        margin-bottom: 15px;
        text-align: center;
        line-height: 1.6;
      }

      .option-btn {
        display: block;
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        font-size: 1rem;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.3s;
      }

      /* Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
      @media (max-width: 600px) {
        #question {
          font-size: 1.2rem; /* Ø®Ø· Ø£ØµØºØ± Ø´ÙˆÙŠØ© Ø¹Ù„Ø´Ø§Ù† ÙŠØ¯Ø®Ù„ */
          padding: 0 10px;
        }

        .option-btn {
          font-size: 0.95rem;
          padding: 10px;
        }
      }

      .progress {
        height: 10px;
        background: #eee;
        border-radius: 999px;
        overflow: hidden;
      }
      .progress > i {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--brand), var(--brand2));
      }

      .timerWrap {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .circle {
        width: 74px;
        height: 74px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        font-weight: 900;
        color: var(--brand);
        background: conic-gradient(var(--brand) 0deg, #eee 0deg);
      }
      @media (max-width: 600px) {
        .circle {
          width: 60px;
          height: 60px;
          font-size: 14px;
        }
        .options {
          gap: 6px;
        }
      }

      .leaders {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .leader {
        background: linear-gradient(180deg, #fff, #fafafa);
        border-radius: 12px;
        padding: 10px;
        display: grid;
        grid-template-columns: 32px 1fr auto;
        gap: 10px;
        align-items: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
        font-weight: 800;
      }
      .leader .bar {
        height: 8px;
        background: #eee;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 6px;
      }
      .leader .bar > i {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--brand), var(--brand2));
      }
      .crown {
        font-size: 18px;
      }
      .rank1 {
        background: linear-gradient(90deg, #ffd700, #ffcf5b);
      }
      .rank2 {
        background: linear-gradient(90deg, #c0c0c0, #e6e6e6);
      }
      .rank3 {
        background: linear-gradient(90deg, #cd7f32, #e0a67a);
      }

      .center {
        text-align: center;
      }
      .hidden {
        display: none;
      }
      footer {
        text-align: center;
        padding: 14px;
        font-size: 13px;
        color: #fff;
        background: linear-gradient(90deg, var(--brand), var(--brand2));
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
      }
      #winnerPopup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background: #fff;
        padding: 28px 36px;
        border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        text-align: center;
        z-index: 9999;
        transition: transform 0.3s ease;
      }
      #winnerPopup.show {
        transform: translate(-50%, -50%) scale(1);
      }
      #winnerPopup h2 {
        font-size: 24px;
        margin: 0 0 12px;
        color: var(--brand);
      }
      #winnerPopup p {
        font-size: 18px;
        margin: 0;
        font-weight: 700;
      }
      #winnerOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.35);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 9998;
      }
      #winnerOverlay.show {
        opacity: 1;
        pointer-events: auto;
      }
      #winnerPopup button {
        margin-top: 18px;
        padding: 10px 20px;
        border: none;
        background: var(--brand);
        color: #fff;
        font-weight: 700;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
      }
      #winnerPopup button:hover {
        transform: translateY(-2px);
      }
      #finalPage {
        background: linear-gradient(180deg, var(--bg1), var(--bg2));
        color: #fff;
        text-align: center;
        padding: 40px;
        width: 100%;
        height: 100vh;
        display: none; /* hidden Ø§ÙØªØ±Ø§Ø¶ÙŠ */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 10000;
      }
      #finalPage.show {
        display: flex; /* ØªØ¸Ù‡Ø± Ù„Ù…Ø§ Ù†Ø¶ÙŠÙ class show */
      }

      #finalPage a {
        color: #ff8a50; /* Ù„ÙˆÙ† ÙˆØ§Ø¶Ø­ Ù„Ù„Ø±Ø§Ø¨Ø· */
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .popup {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="app" role="application">
      <header>
        <div>
          <h1>Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h1>
          <div class="sub" id="topicLabel">Ø§Ù„Ù…Ø­ÙˆØ±: Ø¹Ø§Ù…</div>
        </div>
        <div class="sub">Ø§Ù„Ø­Ø§Ù„Ø©: <span id="statusShort">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±</span></div>
      </header>

      <main>
        <section>
          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
          <div id="welcomeCard" class="card welcome">
            <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!</h2>
            <p class="meta">
              Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙˆØ§Ø¶ØºØ· Ù…Ø´Ø§Ø±ÙƒØ©. ØªØ¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø¹Ø¯Ø¯ 2
              Ù…ØªØ³Ø§Ø¨Ù‚ Ù„Ù„ØªØ¬Ø±Ø¨Ø©.
            </p>
            <input
              id="nameInput"
              class="input"
              placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ (Ù…Ø«Ø§Ù„: Ø±Ø§Ù†ÙŠØ§)"
            />
            <div
              style="
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                justify-content: center;
                margin-top: 8px;
              "
            >
              <button id="joinBtn" class="btn">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>
            </div>
            <div class="meta" style="margin-top: 8px">
              Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø¢Ù†: <b id="playersCount">0</b>
            </div>

            <div id="waitingBox" class="card" style="margin-top: 10px">
              <div class="meta" id="waitingText">
                ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¹Ø¯Ø¯ â€” Ø§Ù„Ø¢Ù† 0 / 2
              </div>
              <div class="progress" style="margin-top: 8px">
                <i id="waitingProgress"></i>
              </div>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© -->
          <div id="quizCard" class="card hidden">
            <div class="row">
              <div style="flex: 1">
                <div class="meta" id="progressText">Ø³Ø¤Ø§Ù„ 0 / 0</div>
                <div id="questionText" class="question">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
                <div class="progress" style="margin-top: 8px">
                  <i id="qProgress"></i>
                </div>
              </div>
              <div class="timerWrap">
                <div class="circle" id="circleTimer">--</div>
                <div style="text-align: right">
                  <div class="meta">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø³Ø¤Ø§Ù„</div>
                  <div
                    id="timeText"
                    style="font-weight: 900; color: var(--brand)"
                  >
                    --
                  </div>
                </div>
              </div>
            </div>

            <div id="options" class="options" style="margin-top: 12px"></div>
            <div
              id="feedback"
              class="meta"
              style="margin-top: 8px; min-height: 20px"
            ></div>

            <div id="doneBox" class="card hidden" style="margin-top: 12px">
              <div class="center">
                <strong>âœ… Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ.</strong>
                <div class="meta" style="margin-top: 6px">
                  Ø§Ù†ØªØ¸Ø± Ø²Ù…Ù„Ø§Ø¦Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©.
                </div>
              </div>
            </div>

            <!-- Ø²Ø± Ø§Ù„Ø§Ù†Ø³Ø­Ø§Ø¨ -->
            <div style="margin-top: 12px; text-align: center">
              <button id="leaveBtn" class="btn" style="background: crimson">
                Ø§Ù†Ø³Ø­Ø§Ø¨
              </button>
            </div>
          </div>
        </section>

        <!-- Ø¬Ø§Ù†Ø¨: ØªØ±ØªÙŠØ¨ Ù…Ø¨Ø§Ø´Ø± -->
        <aside class="aside">
          <div class="card">
            <h3>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h3>
            <ol id="leaderList" class="leaders" style="margin-top: 10px"></ol>
            <div class="meta" style="margin-top: 8px">
              ÙŠØ´Ù…Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©
            </div>
          </div>

          <div class="card" style="margin-top: 12px">
            <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h3>
            <div class="meta">Ø§Ù„Ø­Ø§Ù„Ø©: <b id="statusLabel">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±</b></div>
            <div style="margin-top: 6px" class="meta">
              Ø§Ù„Ù…ØªØµØ¯Ø±: <b id="topBadge">â€”</b>
            </div>
          </div>
        </aside>
      </main>
      <div id="winnerOverlay"></div>
      <div id="finalPage" class="hidden">
        <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
        <p style="margin: 20px 0; font-size: 16px">
          ÙˆÙ„Ùˆ Ø¹Ø§ÙŠØ² Ø¨Ø§Ù‚ÙŠ Ø£Ù‡Ù… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹:
          <a href="https://final-site-seven.vercel.app/" target="_blank"
            >final-site-seven.vercel.app</a
          >
        </p>
        <button id="backToHomeBtn" class="btn" style="margin-top: 20px">
          Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </button>
        <button id="openBtn" style="display: none">ÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
      </div>

      <div id="winnerPopup">
        <h2>ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ!</h2>
        <p id="winnerName">â€”</p>
        <p id="winnerScore">â€” Ù†Ù‚Ø§Ø·</p>
        <button id="closeWinnerPopup">Ø§ØºÙ„Ø§Ù‚</button>
      </div>
      <!-- Ø¶Ø¹ Ù‡Ø°Ø§ ÙÙŠ Ø§Ù„Ù€ body -->
      <div
        id="fullLobbyMsg"
        style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: rgba(0, 0, 0, 0.85);
          color: #fff;
          padding: 25px 40px;
          border-radius: 12px;
          font-size: 22px;
          text-align: center;
          z-index: 9999;
          display: none;
          box-shadow: 0 0 15px #000;
        "
      >
        Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§ÙƒØªÙ…Ù„Øª! Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ğŸ”’
        <br /><br />
        <button
          id="closeLobbyMsg"
          style="
            padding: 8px 20px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #ffd700;
            color: #000;
            font-weight: bold;
          "
        >
          Ø­Ø³Ù†Ø§Ù‹
        </button>
      </div>
      <button id="stopBtn" style="display: none">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>

      <footer>Â© Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</footer>
    </div>

    <!-- Firebase compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
      /* ========== Firebase ========== */
      const firebaseConfig = {
        apiKey: "AIzaSyDOQ1wpof7OhyRRCD_0Of0RY0jggnHmSJ4",
        authDomain: "test-competion.firebaseapp.com",
        databaseURL: "https://test-competion-default-rtdb.firebaseio.com",
        projectId: "test-competion",
        storageBucket: "test-competion.appspot.com",
        messagingSenderId: "605584028373",
        appId: "1:605584028373:web:9cfc40fad5bf6356dbe85c",
        measurementId: "G-7WEQBFVEJW",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const liveRef = db.ref("liveQuiz");
      const playersRef = db.ref("liveQuiz/players");

      /* ========== Ø£Ø³Ø¦Ù„Ø© (Ù…Ø«Ø§Ù„) ========== */
      const QUESTIONS = [
        {
          q: "What is the antonym of 'full'?",
          opts: ["Clean", "Empty", "Long", "Old"],
          a: 1,
        },
        {
          q: "What is the opposite of 'spend'?",
          opts: ["Buy", "Lose", "Save", "Waste"],
          a: 2,
        },
        {
          q: "What is the opposite of 'happy'?",
          opts: ["Sad", "Angry", "Crazy", "Tired"],
          a: 0,
        },
        {
          q: "The opposite of 'soft' is ____.",
          opts: ["Smooth", "Firm", "Rough", "Hard"],
          a: 3,
        },
        {
          q: "Which question word is used to ask about people?",
          opts: ["What", "Who", "Where", "Why"],
          a: 1,
        },
        {
          q: "Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ù„Ø¹Ø§Ù… 2010ØŸ",
          opts: ["Ø§Ù„Ø¯ÙˆØ­Ø©", "Ø§Ù„Ø£Ù‚ØµØ±", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ø®Ø§Ø±Ø¬Ø©"],
          a: 2,
        },
        {
          q: "Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ù„Ø¹Ø§Ù… 2023ØŸ",
          opts: ["Ø§Ù„Ø¯ÙˆØ­Ø©", "Ø§Ù„Ø£Ù‚ØµØ±", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ø®Ø§Ø±Ø¬Ø©"],
          a: 0,
        },
        {
          q: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Ø³Ø§ÙŠÙ„Ùˆ ÙÙˆØ¯Ø² ØªÙ‚Ø¹ Ø¨Ø§Ù„Ø³Ø§Ø¯Ø§Øª Ù…Ø­Ø§ÙØ¸Ø©ØŸ",
          opts: ["Ø§Ù„ØºØ±Ø¨ÙŠØ©", "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©", "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", "Ø³ÙˆÙ‡Ø§Ø¬"],
          a: 1,
        },
        {
          q: "Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù‚ØªØ±Ø§Ø­ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ù‚Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØŸ",
          opts: [
            "Ù…Ø¬Ù„Ø³ Ø§Ù„ÙˆØ²Ø±Ø§Ø¡",
            "Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ",
            "Ø§Ù„Ù…ÙÙˆØ¶ÙŠØ© Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ©",
            "Ù„Ø§ Ø´ÙŠØ¡",
          ],
          a: 2,
        },
        {
          q: "Ø£ÙŠÙ† ØªÙ‚Ø¹ Ù…Ø¯ÙŠÙ†Ø© Ø£Ù‡Ù†Ø§Ø³ÙŠØ§ ÙÙŠ Ù…Ø­Ø§ÙØ¸Ø©ØŸ",
          opts: ["Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ", "Ø§Ù„Ø£Ù‚ØµØ±", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©"],
          a: 0,
        },
        {
          q: "Ù…Ù†Ø­ Ø¬Ø§Ø¦Ø²Ø© Ù†ÙˆØ¨Ù„ Ù„Ù„Ø³Ù„Ø§Ù… Ù„Ù„Ø±Ø¦ÙŠØ³ Ù…Ø­Ù…Ø¯ Ø£Ù†ÙˆØ± Ø§Ù„Ø³Ø§Ø¯Ø§Øª Ø¹Ø§Ù…ØŸ",
          opts: ["1665", "1977", "1978", "1987"],
          a: 2,
        },
        {
          q: "Ø§ÙØªØªØ§Ø­ Ù…Ø­Ø·Ø© ØªØ­ÙŠØ§ Ù…ØµØ± Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø£ØºØ±Ø§Ø¶ Ø¨Ù…ÙŠÙ†Ø§Ø¡ØŸ",
          opts: ["Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ", "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©"],
          a: 2,
        },
        {
          q: "Ø£ÙŠÙ† ØªÙ‚Ø¹ Ù…Ø­Ø·Ø© Ø¹Ø¯Ù„ÙŠ Ù…Ù†ØµÙˆØ± ÙÙŠ Ù…Ø­Ø§ÙØ¸Ø©ØŸ",
          opts: ["Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ", "Ø¨ÙˆØ± Ø³Ø¹ÙŠØ¯", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©"],
          a: 3,
        },
        {
          q: "Ø¹Ù‚Ù„ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù‡Ùˆ ____",
          opts: ["Ø§Ù„Ù‚Ø±Øµ Ø§Ù„ØµÙ„Ø¨", "Ø§Ù„Ø°Ø§ÙƒØ±Ø©", "Ø§Ù„Ø´Ø§Ø´Ø©", "ÙˆØ­Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚"],
          a: 3,
        },
        {
          q: "Ø£ÙŠ Ù…Ù† Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠ ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© (CPU)ØŸ",
          opts: [
            "Ø§Ù„Ø´Ø§Ø´Ø©",
            "ÙˆØ­Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ ALU",
            "Ø§Ù„Ù…Ø³Ø¬Ù„Ø§Øª",
            "ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…",
          ],
          a: 0,
        },
        {
          q: "Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø§ÙƒØ³Ù„ Ù‡ÙˆØŸ",
          opts: ["3001", "200", "255", "100"],
          a: 2,
        },
        {
          q: "ÙÙŠ Ø¹Ø±Ø¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… POWERPOINTØŒ ÙŠÙ…ÙƒÙ† ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ÙƒÙ… Ù…Ø±Ø©ØŸ",
          opts: ["2 : 5", "2 : 10", "1 : 5", "1 : 20"],
          a: 1,
        },
        {
          q: "Ù„ÙØªØ­ Ø¨Ø±Ù†Ø§Ù…Ø¬ WORD Ù‡ØªÙƒØªØ¨ Ø§ÙŠÙ‡ ÙÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø±ØŸ",
          opts: ["Word.exe", "Pinword.exe", "openword.exe", "Winword.exe"],
          a: 3,
        },
        {
          q: "Ù…Ø§ Ù‡Ùˆ Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ© ÙÙŠ Ù…Ø³ØªÙ†Ø¯ØŸ",
          opts: [
            "Function Key 2",
            "Function Key 7",
            "Function Key 5",
            "Function Key 9",
          ],
          a: 1,
        },
        {
          q: 'Ù„Ùˆ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© "Ù‡Ù†Ø¬" ØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø®ØªØµØ§Ø±:',
          opts: ["Ctrl + Alt + Delete", "Ctrl + S", "Alt + F4", "Shift + Esc"],
          a: 0,
        },
        {
          q: "ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ© ØµØ­ÙŠØ­Ø© Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯ ÙˆØ§Ù„Ù…Ø¹Ø¯ÙˆØ¯:",
          opts: [
            "Ù‡Ø¤Ù„Ø§Ø¡ ØªØ³Ø¹Ø©Ù Ø·Ø§Ù„Ø¨Ø§Øª",
            "Ù‡Ø¤Ù„Ø§Ø¡ ØªØ³Ø¹ Ø·Ø§Ù„Ø¨Ø§Øª",
            "Ù‡Ø¤Ù„Ø§Ø¡ ØªØ³Ø¹ Ø·Ù„Ø§Ø¨",
            "Ù‡Ø¤Ù„Ø§Ø¡ ØªØ³Ø¹Ù’ Ø·Ù„Ø§Ø¨",
          ],
          a: 1,
        },
        {
          q: "Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¥Ù…Ù„Ø§Ø¦ÙŠÙ‘Ù‹Ø§ ÙÙŠ Ø§Ù„ÙØ±Ø§Øº ÙÙŠ Ù‚ÙˆÙ„Ù†Ø§: ØªÙ†Ø²Ù‡Ù†Ø§ Ø¹Ù„Ù‰ ........ Ø§Ù„Ø¨Ø­Ø±:",
          opts: ["Ø´ÙˆØ§Ø·Ø¦", "Ø´ÙˆØ§Ø·Ø¤", "Ø´ÙˆØ§Ø·Ø£", "Ø´ÙˆØ§Ø·ÙØ¡"],
          a: 0,
        },
        {
          q: "Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ØªÙŠØ©ØŒ Ù‡Ù…Ø²ØªÙ‡Ø§ Ù‡Ù…Ø²Ø© ÙˆØµÙ„:",
          opts: ["Ø§Ø­ØªØ±Ø§Ù…", "Ø§Ù‚Ø¨Ù„", "Ø§Ù‚Ø±Ø§Ù†", "Ø§Ù†ØµØ§Ù"],
          a: 0,
        },
        {
          q: "Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ØªÙŠØ©ØŒ Ù‡Ù…Ø²ØªÙ‡Ø§ Ù‡Ù…Ø²Ø© Ù‚Ø·Ø¹:",
          opts: ["Ø§Ø³ØªÙ†ØªØ¬", "Ø§Ù†ØªØµØ±", "Ø§Ø«Ù†Ø§Ù†", "Ø§Ù‚Ø¯Ù…"],
          a: 3,
        },
        {
          q: "Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ØªÙŠØ© ÙƒÙØªØ¨Øª Ù‡Ù…Ø²ØªÙ‡Ø§ ØµØ­ÙŠØ­Ø©:",
          opts: ["Ù…ÙØ£Ø³Ù", "Ù…ÙØ´Ù…Ø£Ø²", "Ù…Ø¶ÙŠØ¦Ø©", "Ù…ÙØ¢Ø²Ø±Ø©"],
          a: 2,
        },
        {
          q: "Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ØªÙŠØ© ÙƒÙØªØ¨Øª Ù‡Ù…Ø²ØªÙ‡Ø§ Ø®Ø·Ø£:",
          opts: ["Ù…Ø¤Ù†Ø³", "Ø·Ù…Ø£Ù†", "Ø®Ø·ÙŠØ£Ø©", "Ø¬Ø±ÙŠØ¦Ø©"],
          a: 2,
        },
        {
          q: "Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ØªÙŠØ© ÙƒÙØªØ¨Øª Ù‡Ù…Ø²ØªÙ‡Ø§ ØµØ­ÙŠØ­Ø©:",
          opts: ["Ù…ÙØ£Ù„Ù…", "Ù…ÙØ£Ø³Ø³Ø©", "ÙŠÙØ¢Ø®Ø°", "ÙŠØ¤Ø³Ø³"],
          a: 3,
        },
        {
          q: "Ø§Ø³Ù… Ø§Ù„Ù…ÙØ¹ÙˆÙ„ Ù…Ù† Ø§Ù„ÙØ¹Ù„ (Ø·ÙØ¨Ø®):",
          opts: ["Ù…Ø·Ø¨ÙˆØ®", "Ø·Ø¨Ø§Ø®", "Ù…Ø·Ø¨Ø®", "Ø·Ø§Ø¨Ø®"],
          a: 0,
        },
        {
          q: "Ù‡Ù…Ø²Ø© ÙƒÙ„Ù…Ø© ÙŠØ¬Ø±ÙØ£ ØµØ­ Ø§Ù… Ø®Ø·Ø§ :",
          opts: ["ØµØ­", "Ø®Ø·Ø§"],
          a: 1,
        },
        {
          q: "Ø¥Ø­Ø¯Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¢ØªÙŠØ© ÙƒÙØªØ¨Øª Ø£Ù„ÙÙ‡Ø§ Ø§Ù„Ù…Ù‚ØµÙˆØ±Ø© ØµØ­ÙŠØ­Ø©:",
          opts: ["ØªØµØ¯Ø§", "Ø§ÙØªØ¯Ù‰", "Ù„ÙˆÙ„Ù‰", "Ø®Ø¨Ø§ÙŠÙ‰"],
          a: 1,
        },
      ];

      const REQUIRED_PLAYERS = 2; // Ø§Ù„ØªØ¬Ø±Ø¨Ø© ØªØ¨Ø¯Ø£ Ø¹Ù†Ø¯ 2
      const PER_QUESTION_SECONDS = 15; // 15 Ø«Ø§Ù†ÙŠØ© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„

      /* ========== Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© ========== */
      const $ = (s) => document.querySelector(s);
      const welcomeCard = $("#welcomeCard"),
        joinBtn = $("#joinBtn"),
        nameInput = $("#nameInput"),
        playersCount = $("#playersCount");
      const waitingBox = $("#waitingBox"),
        waitingText = $("#waitingText"),
        waitingProgress = $("#waitingProgress");
      const quizCard = $("#quizCard"),
        questionText = $("#questionText"),
        optionsWrap = $("#options"),
        feedback = $("#feedback");
      const progressText = $("#progressText"),
        qProgress = $("#qProgress"),
        statusShort = $("#statusShort"),
        statusLabel = $("#statusLabel");
      const circleTimer = $("#circleTimer"),
        timeText = $("#timeText"),
        doneBox = $("#doneBox");
      const leaderList = $("#leaderList"),
        topBadge = $("#topBadge");
      const finalPage = document.getElementById("finalPage");
      const backToHomeBtn = document.getElementById("backToHomeBtn");

      /* ========== Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ© ========== */
      let playerId = null,
        playerName = "",
        localScore = 0,
        localIndex = 0,
        questionTimer = null,
        questionDeadline = null,
        started = false;

      /* ========== Ø£ØµÙˆØ§Øª WebAudio (Ø¨Ø¯ÙˆÙ† Ø±ÙˆØ§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠØ©) ========== */
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      let ctx = new AudioCtx();
      let audioUnlocked = false;
      function unlockAudio() {
        if (audioUnlocked) return;
        ctx
          .resume()
          .then(() => (audioUnlocked = true))
          .catch(() => {});
      }
      document.addEventListener("click", unlockAudio, { once: true });
      const leaveBtn = document.getElementById("leaveBtn");

      if (leaveBtn) {
        leaveBtn.addEventListener("click", async () => {
          if (playerId) {
            await db.ref(`liveQuiz/players/${playerId}`).remove();
            playerId = null;
            playerName = "";
            // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
            quizCard.classList.add("hidden");
            welcomeCard.classList.remove("hidden");

            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
            stopAllSounds();
          }
        });
      }

      window.addEventListener("beforeunload", () => {
        if (playerId) {
          db.ref(`liveQuiz/players/${playerId}`).remove();
        }
      });

      function beep({ freq = 600, type = "sine", ms = 200, gain = 0.06 } = {}) {
        try {
          const osc = ctx.createOscillator();
          const g = ctx.createGain();
          osc.type = type;
          osc.frequency.value = freq;
          g.gain.value = gain;
          osc.connect(g);
          g.connect(ctx.destination);
          osc.start();
          setTimeout(() => {
            osc.stop();
          }, ms);
        } catch (e) {}
      }
      const sfx = {
        start: () => beep({ freq: 900, type: "triangle", ms: 200 }),
        correct: () => {
          beep({ freq: 880, type: "sine", ms: 140 });
          setTimeout(() => beep({ freq: 1200, type: "sine", ms: 180 }), 120);
        },
        wrong: () => beep({ freq: 220, type: "sawtooth", ms: 260 }),
        tick: () => beep({ freq: 520, type: "square", ms: 60, gain: 0.03 }),
        win: () => {
          [880, 990, 1180, 1320].forEach((f, i) =>
            setTimeout(() => beep({ freq: f, type: "sine", ms: 160 }), i * 140)
          );
        },
      };
      function stopAllSounds() {
        try {
          // Ù„Ùˆ ÙÙŠ Ø£ÙŠ Audio Ø¨ÙŠØªØ´ØºÙ„ØŒ ÙˆÙ‚ÙÙ‡
          if (ctx && ctx.state !== "closed") {
            ctx.suspend(); // ÙŠÙˆÙ‚Ù ÙƒÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ø¯ÙˆÙ† Ù…Ø§ ÙŠÙ‚ÙÙ„ Ø§Ù„Ù€ context
          }
        } catch (e) {
          console.error("Error stopping sounds:", e);
        }
      }

      /* ========== Ø§Ù†Ø¶Ù…Ø§Ù… ========== */

      const MAX_PLAYERS = 5; // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†

      function showFullLobbyMessage() {
        const msg = document.getElementById("fullLobbyMsg");
        msg.style.display = "block";

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
        const timeoutId = setTimeout(() => {
          msg.style.display = "none";
        }, 5000);

        // Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
        const closeBtn = document.getElementById("closeLobbyMsg");
        closeBtn.onclick = () => {
          clearTimeout(timeoutId);
          msg.style.display = "none";
        };
      }
      let QUIZ_OPEN = true; // Ù„Ùˆ true Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ÙØªÙˆØ­Ø©ØŒ Ù„Ùˆ false Ù…Ù‚ÙÙˆÙ„Ø©

      joinBtn.addEventListener("click", async () => {
        unlockAudio();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…ÙØªÙˆØ­Ø© ÙˆÙ„Ø§ Ù…Ù‚ÙÙˆÙ„Ø©
        if (!QUIZ_OPEN) {
          alert("âŒ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…Ù‚ÙÙˆÙ„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§");
          return;
        }

        // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
        const snap = await playersRef.once("value");
        const currentPlayers = snap.val() || {};
        const numPlayers = Object.keys(currentPlayers).length;

        if (numPlayers >= MAX_PLAYERS) {
          showFullLobbyMessage(); // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¯Ù„ alert
          return;
        }

        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
        const name = (nameInput.value || "").trim();
        if (!name) {
          alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
          return;
        }

        playerName = name;
        const key = playersRef.push().key;
        playerId = key;

        await db.ref(`liveQuiz/players/${playerId}`).set({
          name: playerName,
          score: 0,
          currentQuestion: 0,
          finished: false,
          joinedAt: Date.now(),
        });

        db.ref(`liveQuiz/players/${playerId}`).onDisconnect().remove();
        welcomeCard.classList.add("hidden");

        const live = (await liveRef.once("value")).val() || {};
        if (live.status === "started") {
          started = true;
          startGame();
        }
      });

      /* ========== Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± + Ø¨Ø¯Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ 2 ========== */
      playersRef.on("value", async (snap) => {
        const data = snap.val() || {};
        const arr = Object.entries(data).map(([id, v]) => ({ id, ...v }));
        playersCount.innerText = arr.length;

        // Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        const pct = Math.min(
          100,
          Math.round((arr.length / REQUIRED_PLAYERS) * 100)
        );
        waitingProgress.style.width = pct + "%";
        waitingText.innerText = `ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¹Ø¯Ø¯ â€” Ø§Ù„Ø¢Ù† ${arr.length} / ${REQUIRED_PLAYERS}`;

        // ØªØ±ØªÙŠØ¨ Ù…Ø¨Ø§Ø´Ø±
        renderLeaders(arr);

        // Ù„Ùˆ Ù…ÙÙŠØ´ Ù„Ø§Ø¹Ø¨ÙŠÙ† â†’ reset Ù„Ù„Ø­Ø§Ù„Ø©
        if (arr.length === 0) {
          await liveRef.set({ status: "waiting" });
          return;
        }

        // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„Ù…Ø§ Ù†ÙˆØµÙ„ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ù„Ùˆ Ù…Ø´ Ø¨Ø¯Ø£Øª)
        const live = (await liveRef.once("value")).val() || {};
        if (arr.length >= REQUIRED_PLAYERS && live.status === "waiting") {
          await liveRef.update({ status: "started", startedAt: Date.now() });
        }
      });

      /* ========== Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù€ Live ========== */
      // Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
      liveRef.on("value", (snap) => {
        const val = snap.val() || {};
        const st = val.status || "waiting";

        statusShort.innerText =
          st === "started" ? "Ø¨Ø¯Ø£Øª" : st === "ended" ? "Ø§Ù†ØªÙ‡Øª" : "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±";
        statusLabel.innerText = statusShort.innerText;

        // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø¯Ø£Øª ÙˆÙ„Ù… ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø¹Ø¯
        if (st === "started" && !started && playerId) {
          started = true;
          startGame();
        }

        // Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø² Ø¹Ù†Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù„ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        if (st === "ended" && val.winnerName) {
          showWinner(val.winnerName, val.winnerScore);

          // ØªØ´ØºÙŠÙ„ confetti Ùˆ Ù†ØºÙ…Ø© ÙÙˆØ² Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
          if (!val.celebrated) {
            confetti({ particleCount: 250, spread: 80, origin: { y: 0.2 } });
            sfx.win();

            // Ø¹Ù„Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù†Ù‡ ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ù„
            liveRef.update({ celebrated: true }).catch(() => {});
          }
        }
      });

      /* ========== Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© (Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„) ========== */
      function startGame() {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ù…Ø­Ù„ÙŠØ©
        localScore = 0;
        localIndex = 0;
        quizCard.classList.remove("hidden");
        welcomeCard.classList.add("hidden");
        sfx.start();
        renderQuestion();
      }

      /* ========== Ø§Ù„Ù…Ø¤Ù‚Øª Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ ========== */
      function startQuestionTimer(totalSec = PER_QUESTION_SECONDS) {
        stopQuestionTimer();
        const endAt = Date.now() + totalSec * 1000;
        questionDeadline = endAt;

        questionTimer = setInterval(() => {
          const remain = Math.max(
            0,
            Math.ceil((questionDeadline - Date.now()) / 1000)
          );
          timeText.innerText = remain + " Ø«";
          // Ø¯Ø§Ø¦Ø±Ø©
          const elapsed =
            PER_QUESTION_SECONDS * 1000 -
            Math.max(0, questionDeadline - Date.now());
          const pct = Math.min(
            100,
            Math.round((elapsed / (PER_QUESTION_SECONDS * 1000)) * 100)
          );
          circleTimer.style.background = `conic-gradient(var(--brand) ${
            pct * 3.6
          }deg, #eee ${pct * 3.6}deg)`;
          circleTimer.innerText = remain;

          if (remain <= 5 && remain > 0) sfx.tick();

          if (remain <= 0) {
            stopQuestionTimer();
            // Ø¨Ø¯ÙˆÙ† Ø¥Ø¬Ø§Ø¨Ø© â†’ ÙŠÙ†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
            nextQuestion();
          }
        }, 200);
      }
      function stopQuestionTimer() {
        if (questionTimer) {
          clearInterval(questionTimer);
          questionTimer = null;
        }
      }

      /* ========== Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„/Ø¥Ø¬Ø§Ø¨Ø§Øª ========== */
      let optionLock = false;
      function renderQuestion() {
        feedback.innerText = "";
        doneBox.classList.add("hidden");

        if (localIndex >= QUESTIONS.length) {
          // Ø®Ù„Ù‘ØµÙ†Ø§
          finishLocal();
          return;
        }

        const q = QUESTIONS[localIndex];
        questionText.innerText = q.q;
        optionsWrap.innerHTML = "";
        optionLock = false;

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        progressText.innerText = `Ø³Ø¤Ø§Ù„ ${localIndex + 1} / ${QUESTIONS.length}`;
        qProgress.style.width =
          Math.round((localIndex / QUESTIONS.length) * 100) + "%";

        // Ø®ÙŠØ§Ø±Ø§Øª (shuffle Ø¨Ø³ÙŠØ·)
        const opts = q.opts
          .map((o, i) => ({ o, i }))
          .sort(() => Math.random() - 0.5);
        opts.forEach(({ o, i }) => {
          const div = document.createElement("div");
          div.className = "option";
          div.innerText = o;
          div.onclick = async () => {
            if (optionLock) return;
            optionLock = true;

            if (i === q.a) {
              div.classList.add("correct");
              feedback.innerText = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…";
              sfx.correct();
              await db
                .ref(`liveQuiz/players/${playerId}/score`)
                .transaction((s) => (s || 0) + 1);
            } else {
              div.classList.add("wrong");
              feedback.innerText = `Ø®Ø·Ø£ âŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${q.opts[q.a]}`;
              sfx.wrong();
              // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„ØµØ­
              Array.from(optionsWrap.children).forEach((c) => {
                if (c.innerText === q.opts[q.a]) c.classList.add("correct");
              });
            }

            // Ø­Ø¯Ù‘Ø« Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø¹Ø±Ø¶)
            await db
              .ref(`liveQuiz/players/${playerId}`)
              .update({ currentQuestion: localIndex + 1 });

            setTimeout(() => nextQuestion(), 900);
          };
          optionsWrap.appendChild(div);
        });

        // Ø´ØºÙ‘Ù„ Ù…Ø¤Ù‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„
        startQuestionTimer(PER_QUESTION_SECONDS);
      }

      function nextQuestion() {
        stopQuestionTimer();
        localIndex++;
        renderQuestion();
      }

      async function finishLocal() {
        stopQuestionTimer();
        optionsWrap.innerHTML = "";
        feedback.innerText = "Ø§Ù†ØªÙ‡ÙŠØª â€” Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©";
        doneBox.classList.remove("hidden");

        // Ø¹Ù„Ù‘Ù… Ù†ÙØ³Ùƒ Ù…Ù†ØªÙ‡ÙŠ
        if (playerId)
          await db
            .ref(`liveQuiz/players/${playerId}`)
            .update({ finished: true });

        // ØªØ­Ù‚Ù‚ Ø¥Ù† ÙƒØ§Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù†ØªÙ‡Ù‰ â†’ Ø§Ù†Ù‡ÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø©
        const snap = await playersRef.once("value");
        const data = snap.val() || {};
        const arr = Object.values(data);
        const allFinished = arr.length > 0 && arr.every((p) => p.finished);
        if (allFinished) {
          await liveRef.update({ status: "ended", endedAt: Date.now() });
          finalize();
        }
      }

      /* ========== Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ========== */
      function renderLeaders(list) {
        const arr = list
          .slice()
          .sort((a, b) => (b.score || 0) - (a.score || 0));
        leaderList.innerHTML = "";
        arr.forEach((p, i) => {
          const li = document.createElement("li");
          li.className = "leader";
          if (i === 0) li.classList.add("rank1");
          if (i === 1) li.classList.add("rank2");
          if (i === 2) li.classList.add("rank3");

          const crown = i === 0 ? "ğŸ‘‘" : i + 1;
          const name = (p.name || "Ù„Ø§Ø¹Ø¨").toString();
          const score = p.score || 0;
          const pct = Math.min(
            100,
            Math.round((score / Math.max(1, QUESTIONS.length)) * 100)
          );

          li.innerHTML = `
                <div class="crown">${crown}</div>
                <div>
                  <div>${escapeHtml(name)}</div>
                  <div class="bar"><i style="width:${pct}%"></i></div>
                </div>
                <div>${score} Ù†Ù‚Ø·Ø©</div>
              `;
          leaderList.appendChild(li);
        });
        topBadge.innerText = arr.length
          ? `${arr[0].name || "Ù„Ø§Ø¹Ø¨"} (${arr[0].score || 0})`
          : "â€”";
      }

      function escapeHtml(s) {
        return (s || "").toString().replace(
          /[&<>"']/g,
          (c) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[c])
        );
      }

      /* ========== Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© + Ø§Ø­ØªÙØ§Ù„ ========== */
      async function finalize() {
        try {
          const snap = await playersRef.once("value");
          const data = snap.val() || {};
          const arr = Object.entries(data).map(([id, v]) => ({
            id,
            name: v.name || "Ù„Ø§Ø¹Ø¨",
            score: v.score || 0,
          }));

          if (!arr.length) return;

          // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
          arr.sort((a, b) => b.score - a.score);

          const winner = arr[0];
          const winnerName = winner.name;
          const winnerScore = winner.score;

          // ØªØ­Ø¯ÙŠØ« liveRef Ø­ØªÙ‰ ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠØ´ÙˆÙÙˆØ§ Ø§Ù„ÙØ§Ø¦Ø²
          await liveRef.update({
            winnerName,
            winnerScore,
            status: "ended",
            announced: false,
          });

          // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
          setTimeout(async () => {
            await playersRef.remove();
            await liveRef.update({ status: "waiting" });
            welcomeCard.classList.remove("hidden");
            quizCard.classList.add("hidden");
            started = false;
            statusShort.innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±";
            statusLabel.innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±";
          }, 5000);
        } catch (e) {
          console.error("Error in finalize:", e);
        }
      }

      const winnerPopup = document.getElementById("winnerPopup");
      const winnerOverlay = document.getElementById("winnerOverlay");
      const winnerNameEl = document.getElementById("winnerName");
      const winnerScoreEl = document.getElementById("winnerScore");
      const closeWinnerBtn = document.getElementById("closeWinnerPopup");

      function showWinner(name, score) {
        winnerNameEl.innerText = name;
        winnerScoreEl.innerText = score + " Ù†Ù‚Ø·Ø©";
        winnerOverlay.classList.add("show");
        winnerPopup.classList.add("show");
      }

      // Ù„Ù…Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ØºØ· Ø§ØºÙ„Ø§Ù‚ Ø£Ùˆ Ø¹Ù„Ù‰ overlay
      function hideWinner() {
        // Ø§Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙˆÙƒØ³ ÙˆØ§Ù„Ù€ overlay
        winnerOverlay.classList.remove("show");
        winnerPopup.classList.remove("show");

        // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±
        setTimeout(() => {
          finalPage.classList.remove("hidden"); // Ø¨Ø¯Ù„ add("show") Ø§Ø³ØªØ®Ø¯Ù… remove("hidden")
          finalPage.classList.add("show"); // Ø£Ùˆ Ø®Ù„ÙŠÙ‡Ø§ add("show") Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        }, 300);
      }

      // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      backToHomeBtn.addEventListener("click", () => {
        // Ø§Ø®ÙØ§Ø¡ ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        finalPage.classList.remove("show");
        finalPage.classList.add("hidden");

        // Ø§Ø±Ø¬Ø¹ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        welcomeCard.classList.remove("hidden");
        quizCard.classList.add("hidden");
        started = false;
        statusShort.innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±";
        statusLabel.innerText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±";
      });

      // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      closeWinnerBtn.addEventListener("click", hideWinner);
      winnerOverlay.addEventListener("click", hideWinner);
      let contestTimer;

      function startContest() {
        // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        console.log("Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø¯Ø£Øª!");

        // Ù†Ø´ØºÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒÙ„ÙŠ (Ù…Ø«Ù„Ø§Ù‹ 15 Ø¯Ù‚ÙŠÙ‚Ø© = 900,000 Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
        contestTimer = setTimeout(() => {
          endContest();
        }, 15 * 60 * 1000);
      }

      function endContest() {
        console.log("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!");
        // Ù‡Ù†Ø§ ØªÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ ÙŠÙ‚ÙÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
        // Ù…Ø«Ù„Ø§: Ù…Ù†Ø¹ Ø§Ø±Ø³Ø§Ù„ Ø§Ø¬Ø§Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© + Ø§Ø¹Ù„Ø§Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
        clearTimeout(contestTimer);
      }

      document.getElementById("openBtn").addEventListener("click", () => {
        QUIZ_OPEN = true;
        alert("âœ… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§ØªÙØªØ­Øª");
      });

      document.getElementById("stopBtn").addEventListener("click", () => {
        QUIZ_OPEN = false;
        alert("â›” Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§ØªÙ‚ÙÙ„Øª");
      });
    </script>
  </body>
</html>
