<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مسابقة أعضاء جروب المشتركين للتدريب</title>
    <style>
      body {
        font-family: Cairo, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(120deg, #fdfbfb, #ebedee);
      }
      .container {
        max-width: 700px;
        margin: 20px auto;
        padding: 20px;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        text-align: center;
      }
      h2 {
        color: #333;
      }
      input,
      button {
        padding: 10px;
        margin: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      button {
        cursor: pointer;
        background-color: #4caf50;
        color: white;
        font-weight: bold;
        transition: 0.3s;
      }
      button:hover {
        background-color: #45a049;
      }
      #competition {
        display: none;
        margin-top: 20px;
      }
      .question {
        margin: 20px 0;
        font-size: 18px;
      }
      .optionBtn {
        display: block;
        margin: 10px auto;
        padding: 10px;
        width: 80%;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        background: #2196f3;
        color: white;
        transition: 0.3s;
      }
      .optionBtn:hover {
        background: #1976d2;
      }
      #leaderboard {
        margin-top: 20px;
        text-align: right;
      }
      #leaderboard ul {
        list-style: none;
        padding: 0;
      }
      #leaderboard li {
        padding: 5px;
        font-weight: bold;
      }
      #celebration {
        display: none;
        font-size: 24px;
        color: green;
        animation: blink 1s infinite;
        margin-top: 20px;
      }
      @keyframes blink {
        0%,
        50%,
        100% {
          opacity: 1;
        }
        25%,
        75% {
          opacity: 0;
        }
      }
      .progress {
        height: 20px;
        background: #eee;
        border-radius: 10px;
        margin: 10px 0;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        background: #4caf50;
        width: 0%;
        transition: 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>أهلاً بكم في مسابقة أعضاء جروب المشتركين للتدريب!</h2>
      <p id="competitionTopic">محور المسابقة: عام</p>

      <div id="loginForm">
        <input type="text" id="username" placeholder="اكتب اسمك" />
        <button onclick="joinCompetition()">المشاركة</button>
      </div>

      <div id="waiting" style="display: none">
        <p id="waitMessage"></p>
      </div>

      <div id="competition">
        <div class="progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="question" id="questionText"></div>
        <div id="options"></div>
        <p id="status"></p>
      </div>

      <div id="leaderboard">
        <h3>الترتيب المباشر:</h3>
        <ul id="rankList"></ul>
      </div>

      <div id="celebration">🎉 الفائز: <span id="winnerName"></span> 🎉</div>
    </div>

    <audio id="cheerAudio">
      <source src="cheer.mp3" type="audio/mpeg" />
    </audio>

    <script>
      // ==== بيانات الأسئلة التجريبية ====
      const allQuestions = [
        {
          q: "ما هي عاصمة مصر؟",
          options: ["القاهرة", "الإسكندرية", "أسوان", "الأقصر"],
          answer: 0,
        },
        {
          q: "كم عدد الأهرامات الرئيسية في الجيزة؟",
          options: [1, 2, 3, 4],
          answer: 2,
        },
        {
          q: "ما لون السماء؟",
          options: ["أحمر", "أزرق", "أخضر", "أسود"],
          answer: 1,
        },
        { q: "كم عدد أيام الأسبوع؟", options: [5, 6, 7, 8], answer: 2 },
        {
          q: "ما هو أسرع حيوان على الأرض؟",
          options: ["الأسد", "الفهد", "الحصان", "الكلب"],
          answer: 1,
        },
      ];

      let currentUser = "";
      let currentQuestion = 0;
      let score = 0;
      let players = [];
      let competitionStarted = false;
      let maxPlayers = 2; // عدد المتسابقين المطلوب
      let numQuestions = 5; // عدد الأسئلة

      // ==== المشاركة ====
      function joinCompetition() {
        const name = document.getElementById("username").value.trim();
        if (!name) {
          alert("اكتبي اسمك");
          return;
        }
        if (players.some((p) => p.name === name)) {
          alert("هذا الاسم مسجل بالفعل");
          return;
        }
        players.push({ name: name, score: 0 });
        currentUser = name;
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("waiting").style.display = "block";
        updateWaitMessage();
        checkStartCompetition();
      }

      // ==== تحديث رسالة الانتظار ====
      function updateWaitMessage() {
        document.getElementById(
          "waitMessage"
        ).textContent = `انتظار باقي المتسابقين... (${players.length}/${maxPlayers})`;
      }

      // ==== بدء المسابقة تلقائي ====
      function checkStartCompetition() {
        updateWaitMessage();
        if (players.length >= maxPlayers && !competitionStarted) {
          competitionStarted = true;
          document.getElementById("waiting").style.display = "none";
          startCompetition();
          startCheer(); // بدء الأصوات
        }
      }

      // ==== المسابقة ====
      let questions = [];
      function startCompetition() {
        questions = shuffleArray(allQuestions).slice(0, numQuestions);
        document.getElementById("competition").style.display = "block";
        currentQuestion = 0;
        score = 0;
        showQuestion();
        updateLeaderboard();
      }

      function showQuestion() {
        if (currentQuestion >= questions.length) {
          document.getElementById(
            "competition"
          ).innerHTML = `<h3>انتهت المسابقة! نتيجتك: ${score}</h3>`;
          checkEndCompetition();
          return;
        }
        const q = questions[currentQuestion];
        document.getElementById("questionText").textContent = q.q;
        const opts = document.getElementById("options");
        opts.innerHTML = "";
        q.options.forEach((o, i) => {
          const btn = document.createElement("button");
          btn.textContent = o;
          btn.className = "optionBtn";
          btn.onclick = () => {
            checkAnswer(i);
          };
          opts.appendChild(btn);
        });

        // تحديث progress bar
        document.getElementById("progressBar").style.width =
          (currentQuestion / numQuestions) * 100 + "%";
      }

      function checkAnswer(selected) {
        if (selected === questions[currentQuestion].answer) score++;
        currentQuestion++;
        // تحديث النتيجة في قائمة اللاعبين
        const player = players.find((p) => p.name === currentUser);
        if (player) player.score = score;
        updateLeaderboard();
        showQuestion();
      }

      // ==== تحديث Leaderboard ====
      function updateLeaderboard() {
        const ul = document.getElementById("rankList");
        ul.innerHTML = "";
        players.sort((a, b) => b.score - a.score);
        players.forEach((p) => {
          const li = document.createElement("li");
          li.textContent = `${p.name}: ${p.score}`;
          ul.appendChild(li);
        });
      }

      // ==== نهاية المسابقة ====
      function checkEndCompetition() {
        const maxScore = Math.max(...players.map((p) => p.score));
        const winner = players.find((p) => p.score === maxScore);
        document.getElementById("winnerName").textContent = winner.name;
        document.getElementById("celebration").style.display = "block";
        stopCheer();
      }

      // ==== الأصوات التشجيعية ====
      let cheerInterval;
      function startCheer() {
        const audio = document.getElementById("cheerAudio");
        cheerInterval = setInterval(() => {
          audio.play();
        }, 10000);
      }
      function stopCheer() {
        clearInterval(cheerInterval);
      }

      // ==== مساعدة ====
      function shuffleArray(array) {
        return array.sort(() => Math.random() - 0.5);
      }
    </script>
  </body>
</html>
