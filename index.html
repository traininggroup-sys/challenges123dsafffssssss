<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ø¬Ø±ÙˆØ¨ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ù„ØªØ¯Ø±ÙŠØ¨</title>
    <style>
      body {
        font-family: Cairo, sans-serif;
        background: #f0f0f0;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 700px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
      }
      #adminPanel {
        display: none;
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 10px;
        background: #e0e0e0;
      }
      #competition {
        display: none;
        margin-top: 20px;
      }
      .question {
        margin: 20px 0;
      }
      #leaderboard {
        margin-top: 20px;
      }
      #celebration {
        display: none;
        font-size: 24px;
        color: green;
        animation: blink 1s infinite;
      }
      @keyframes blink {
        0%,
        50%,
        100% {
          opacity: 1;
        }
        25%,
        75% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! <span id="competitionTopic"></span></h2>

      <div id="loginForm">
        <input type="text" id="username" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" />
        <button onclick="joinCompetition()">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>
        <button onclick="showAdmin()">Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø±Ø§Ù‚Ø¨</button>
      </div>

      <div id="adminLogin" style="display: none">
        <input type="email" id="adminEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
        <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
        <button onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
      </div>

      <div id="adminPanel">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
        <p>Ø­Ø¯Ø¯ Ù…Ø­ÙˆØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†:</p>
        <input type="text" id="topic" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ" />
        <input
          type="number"
          id="numQuestions"
          placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©"
          min="1"
          max="20"
        />
        <input
          type="number"
          id="numPlayers"
          placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨"
          min="1"
          max="50"
        />
        <button onclick="setCompetition()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <div id="adminStatus"></div>
      </div>

      <div id="competition">
        <h3 id="questionText"></h3>
        <div id="options"></div>
        <p id="status"></p>
      </div>

      <div id="leaderboard">
        <h3>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</h3>
        <ul id="rankList"></ul>
      </div>

      <div id="celebration">ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: <span id="winnerName"></span> ğŸ‰</div>
    </div>

    <audio id="cheerAudio">
      <source src="cheer.mp3" type="audio/mpeg" />
    </audio>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script>
      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyDUMMY",
        authDomain: "test-competion.firebaseapp.com",
        projectId: "test-competion",
        storageBucket: "test-competion.appspot.com",
        messagingSenderId: "1234567890",
        appId: "1:1234567890:web:abcd",
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();

      // ==== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ====
      const allQuestions = [
        {
          q: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ",
          options: ["Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø£Ø³ÙˆØ§Ù†", "Ø§Ù„Ø£Ù‚ØµØ±"],
          answer: 0,
        },
        {
          q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø±Ø§Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„Ø¬ÙŠØ²Ø©ØŸ",
          options: [1, 2, 3, 4],
          answer: 2,
        },
        {
          q: "Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ØŸ",
          options: ["Ø£Ø­Ù…Ø±", "Ø£Ø²Ø±Ù‚", "Ø£Ø®Ø¶Ø±", "Ø£Ø³ÙˆØ¯"],
          answer: 1,
        },
        { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ", options: [5, 6, 7, 8], answer: 2 },
        {
          q: "Ù…Ø§ Ù‡Ùˆ Ø£Ø³Ø±Ø¹ Ø­ÙŠÙˆØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ØŸ",
          options: ["Ø§Ù„Ø£Ø³Ø¯", "Ø§Ù„ÙÙ‡Ø¯", "Ø§Ù„Ø­ØµØ§Ù†", "Ø§Ù„ÙƒÙ„Ø¨"],
          answer: 1,
        },
        {
          q: "Ù…Ø§ Ù‡ÙŠ Ù„ØºØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©ØŸ",
          options: ["Python", "C++", "Java", "HTML"],
          answer: 0,
        },
        {
          q: "Ø£ÙŠ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø´Ù…Ø³ØŸ",
          options: ["Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ø£Ø±Ø¶", "Ø¹Ø·Ø§Ø±Ø¯", "Ø§Ù„Ø²Ù‡Ø±Ø©"],
          answer: 2,
        },
        {
          q: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ù…Ø­ÙŠØ· ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
          options: ["Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ", "Ø§Ù„Ù‡Ø§Ø¯Ø¦", "Ø§Ù„Ù‡Ù†Ø¯ÙŠ", "Ø§Ù„Ù…ØªØ¬Ù…Ø¯"],
          answer: 1,
        },
      ];

      let currentUser = "";
      let currentQuestion = 0;
      let score = 0;
      let players = [];
      let competitionStarted = false;
      let competitionSettings = { topic: "", numQuestions: 5, numPlayers: 5 };

      // ==== Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ====
      function joinCompetition() {
        const name = document.getElementById("username").value.trim();
        if (!name) {
          alert("Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ");
          return;
        }
        if (players.includes(name)) {
          alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„");
          return;
        }
        players.push(name);
        currentUser = name;
        document.getElementById("loginForm").style.display = "none";
        document.getElementById(
          "status"
        ).textContent = `Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†... (${players.length}/${competitionSettings.numPlayers})`;
        checkStartCompetition();
      }

      // ==== Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ ====
      function checkStartCompetition() {
        if (
          players.length >= competitionSettings.numPlayers &&
          !competitionStarted
        ) {
          competitionStarted = true;
          startCompetition();
          startCheer(); // Ø¨Ø¯Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª
        }
      }

      // ==== Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ====
      let questions = [];
      function startCompetition() {
        questions = shuffleArray(allQuestions).slice(
          0,
          competitionSettings.numQuestions
        );
        document.getElementById("competitionTopic").textContent =
          competitionSettings.topic;
        document.getElementById("competition").style.display = "block";
        currentQuestion = 0;
        score = 0;
        showQuestion();
        updateLeaderboard();
      }

      function showQuestion() {
        if (currentQuestion >= questions.length) {
          document.getElementById(
            "competition"
          ).innerHTML = `<h3>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! Ù†ØªÙŠØ¬ØªÙƒ: ${score}</h3>`;
          checkEndCompetition();
          return;
        }
        const q = questions[currentQuestion];
        document.getElementById("questionText").textContent = q.q;
        const opts = document.getElementById("options");
        opts.innerHTML = "";
        q.options.forEach((o, i) => {
          const btn = document.createElement("button");
          btn.textContent = o;
          btn.onclick = () => {
            checkAnswer(i);
          };
          opts.appendChild(btn);
        });
      }

      function checkAnswer(selected) {
        if (selected === questions[currentQuestion].answer) score++;
        currentQuestion++;
        updateLeaderboard();
        showQuestion();
      }

      // ==== ØªØ­Ø¯ÙŠØ« Leaderboard ====
      function updateLeaderboard() {
        const ul = document.getElementById("rankList");
        ul.innerHTML = "";
        const data = players
          .map((p) => {
            let s = p === currentUser ? score : 0;
            return { name: p, score: s };
          })
          .sort((a, b) => b.score - a.score);
        data.forEach((d) => {
          const li = document.createElement("li");
          li.textContent = `${d.name}: ${d.score}`;
          ul.appendChild(li);
        });
      }

      // ==== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ====
      function checkEndCompetition() {
        const maxScore = Math.max(
          ...players.map((p) => (p === currentUser ? score : 0))
        );
        document.getElementById("winnerName").textContent = currentUser;
        document.getElementById("celebration").style.display = "block";
        stopCheer();
      }

      // ==== Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ´Ø¬ÙŠØ¹ÙŠØ© ====
      let cheerInterval;
      function startCheer() {
        const audio = document.getElementById("cheerAudio");
        cheerInterval = setInterval(() => {
          audio.play();
        }, 10000);
      }
      function stopCheer() {
        clearInterval(cheerInterval);
      }

      // ==== Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase Auth ====
      function showAdmin() {
        document.getElementById("adminLogin").style.display = "block";
      }
      function loginAdmin() {
        const email = document.getElementById("adminEmail").value.trim();
        const pass = document.getElementById("adminPassword").value.trim();
        auth
          .signInWithEmailAndPassword(email, pass)
          .then((userCredential) => {
            document.getElementById("adminPanel").style.display = "block";
            document.getElementById("adminLogin").style.display = "none";
          })
          .catch((err) => alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©!"));
      }

      function setCompetition() {
        const topic = document.getElementById("topic").value.trim();
        const numQ = parseInt(document.getElementById("numQuestions").value);
        const numP = parseInt(document.getElementById("numPlayers").value);
        if (!topic || !numQ || !numP) {
          alert("Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„");
          return;
        }
        competitionSettings = {
          topic: topic,
          numQuestions: numQ,
          numPlayers: numP,
        };
        document.getElementById(
          "adminStatus"
        ).textContent = `ØªÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯: Ù…Ø­ÙˆØ±=${topic}, Ø§Ù„Ø£Ø³Ø¦Ù„Ø©=${numQ}, Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†=${numP}`;
      }

      // ==== Ù…Ø³Ø§Ø¹Ø¯Ø© ====
      function shuffleArray(array) {
        return array.sort(() => Math.random() - 0.5);
      }
    </script>
  </body>
</html>
