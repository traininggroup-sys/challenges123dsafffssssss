<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ø¬Ø±ÙˆØ¨ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ù„ØªØ¯Ø±ÙŠØ¨</title>
    <style>
      body {
        font-family: Cairo, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(120deg, #fdfbfb, #ebedee);
      }
      .container {
        max-width: 700px;
        margin: 20px auto;
        padding: 20px;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        text-align: center;
      }
      h2 {
        color: #333;
      }
      input,
      button {
        padding: 10px;
        margin: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      button {
        cursor: pointer;
        background-color: #4caf50;
        color: white;
        font-weight: bold;
        transition: 0.3s;
      }
      button:hover {
        background-color: #45a049;
      }
      #competition {
        display: none;
        margin-top: 20px;
      }
      .question {
        margin: 20px 0;
        font-size: 18px;
      }
      .optionBtn {
        display: block;
        margin: 10px auto;
        padding: 10px;
        width: 80%;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        background: #2196f3;
        color: white;
        transition: 0.3s;
      }
      .optionBtn:hover {
        background: #1976d2;
      }
      #leaderboard {
        margin-top: 20px;
        text-align: right;
      }
      #leaderboard ul {
        list-style: none;
        padding: 0;
      }
      #leaderboard li {
        padding: 5px;
        font-weight: bold;
      }
      #celebration {
        display: none;
        font-size: 24px;
        color: green;
        animation: blink 1s infinite;
        margin-top: 20px;
      }
      @keyframes blink {
        0%,
        50%,
        100% {
          opacity: 1;
        }
        25%,
        75% {
          opacity: 0;
        }
      }
      .progress {
        height: 20px;
        background: #eee;
        border-radius: 10px;
        margin: 10px 0;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        background: #4caf50;
        width: 0%;
        transition: 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø£Ø¹Ø¶Ø§Ø¡ Ø¬Ø±ÙˆØ¨ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ù„ØªØ¯Ø±ÙŠØ¨!</h2>
      <p id="competitionTopic">Ù…Ø­ÙˆØ± Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©: Ø¹Ø§Ù…</p>

      <div id="loginForm">
        <input type="text" id="username" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ" />
        <button onclick="joinCompetition()">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</button>
      </div>

      <div id="waiting" style="display: none">
        <p id="waitMessage"></p>
      </div>

      <div id="competition">
        <div class="progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="question" id="questionText"></div>
        <div id="options"></div>
        <p id="status"></p>
      </div>

      <div id="leaderboard">
        <h3>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</h3>
        <ul id="rankList"></ul>
      </div>

      <div id="celebration">ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²: <span id="winnerName"></span> ğŸ‰</div>
    </div>

    <audio id="cheerAudio">
      <source src="cheer.mp3" type="audio/mpeg" />
    </audio>

    <script>
      // ==== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ====
      const allQuestions = [
        {
          q: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ",
          options: ["Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø£Ø³ÙˆØ§Ù†", "Ø§Ù„Ø£Ù‚ØµØ±"],
          answer: 0,
        },
        {
          q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‡Ø±Ø§Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„Ø¬ÙŠØ²Ø©ØŸ",
          options: [1, 2, 3, 4],
          answer: 2,
        },
        {
          q: "Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ØŸ",
          options: ["Ø£Ø­Ù…Ø±", "Ø£Ø²Ø±Ù‚", "Ø£Ø®Ø¶Ø±", "Ø£Ø³ÙˆØ¯"],
          answer: 1,
        },
        { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ", options: [5, 6, 7, 8], answer: 2 },
        {
          q: "Ù…Ø§ Ù‡Ùˆ Ø£Ø³Ø±Ø¹ Ø­ÙŠÙˆØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ØŸ",
          options: ["Ø§Ù„Ø£Ø³Ø¯", "Ø§Ù„ÙÙ‡Ø¯", "Ø§Ù„Ø­ØµØ§Ù†", "Ø§Ù„ÙƒÙ„Ø¨"],
          answer: 1,
        },
      ];

      let currentUser = "";
      let currentQuestion = 0;
      let score = 0;
      let players = [];
      let competitionStarted = false;
      let maxPlayers = 2; // Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
      let numQuestions = 5; // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©

      // ==== Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ====
      function joinCompetition() {
        const name = document.getElementById("username").value.trim();
        if (!name) {
          alert("Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ");
          return;
        }
        if (players.some((p) => p.name === name)) {
          alert("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„");
          return;
        }
        players.push({ name: name, score: 0 });
        currentUser = name;
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("waiting").style.display = "block";
        updateWaitMessage();
        checkStartCompetition();
      }

      // ==== ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ====
      function updateWaitMessage() {
        document.getElementById(
          "waitMessage"
        ).textContent = `Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†... (${players.length}/${maxPlayers})`;
      }

      // ==== Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ ====
      function checkStartCompetition() {
        updateWaitMessage();
        if (players.length >= maxPlayers && !competitionStarted) {
          competitionStarted = true;
          document.getElementById("waiting").style.display = "none";
          startCompetition();
          startCheer(); // Ø¨Ø¯Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª
        }
      }

      // ==== Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ====
      let questions = [];
      function startCompetition() {
        questions = shuffleArray(allQuestions).slice(0, numQuestions);
        document.getElementById("competition").style.display = "block";
        currentQuestion = 0;
        score = 0;
        showQuestion();
        updateLeaderboard();
      }

      function showQuestion() {
        if (currentQuestion >= questions.length) {
          document.getElementById(
            "competition"
          ).innerHTML = `<h3>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! Ù†ØªÙŠØ¬ØªÙƒ: ${score}</h3>`;
          checkEndCompetition();
          return;
        }
        const q = questions[currentQuestion];
        document.getElementById("questionText").textContent = q.q;
        const opts = document.getElementById("options");
        opts.innerHTML = "";
        q.options.forEach((o, i) => {
          const btn = document.createElement("button");
          btn.textContent = o;
          btn.className = "optionBtn";
          btn.onclick = () => {
            checkAnswer(i);
          };
          opts.appendChild(btn);
        });

        // ØªØ­Ø¯ÙŠØ« progress bar
        document.getElementById("progressBar").style.width =
          (currentQuestion / numQuestions) * 100 + "%";
      }

      function checkAnswer(selected) {
        if (selected === questions[currentQuestion].answer) score++;
        currentQuestion++;
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        const player = players.find((p) => p.name === currentUser);
        if (player) player.score = score;
        updateLeaderboard();
        showQuestion();
      }

      // ==== ØªØ­Ø¯ÙŠØ« Leaderboard ====
      function updateLeaderboard() {
        const ul = document.getElementById("rankList");
        ul.innerHTML = "";
        players.sort((a, b) => b.score - a.score);
        players.forEach((p) => {
          const li = document.createElement("li");
          li.textContent = `${p.name}: ${p.score}`;
          ul.appendChild(li);
        });
      }

      // ==== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ====
      function checkEndCompetition() {
        const maxScore = Math.max(...players.map((p) => p.score));
        const winner = players.find((p) => p.score === maxScore);
        document.getElementById("winnerName").textContent = winner.name;
        document.getElementById("celebration").style.display = "block";
        stopCheer();
      }

      // ==== Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ´Ø¬ÙŠØ¹ÙŠØ© ====
      let cheerInterval;
      function startCheer() {
        const audio = document.getElementById("cheerAudio");
        cheerInterval = setInterval(() => {
          audio.play();
        }, 10000);
      }
      function stopCheer() {
        clearInterval(cheerInterval);
      }

      // ==== Ù…Ø³Ø§Ø¹Ø¯Ø© ====
      function shuffleArray(array) {
        return array.sort(() => Math.random() - 0.5);
      }
    </script>
  </body>
</html>
